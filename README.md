# Apraam's Translator
Небольшой проект за выходные. Транслятор подобия симкода в вузовский ассемблер.  

## Содержание
- [Технологии](#технологии)
- [По существу](#по-существу)
- [Начало работы](#начало-работы)
- [Команда проекта](#команда-проекта)

## Технологии
- C++

## По существу
### Таблица трансляции
Обозначения: маленькими буквами указываются регистры, заглавной А - абсолютная память. Буква I - непосредственный операнд.
| Симкод   | Результат трансляции | Примечание |        
|----------|----------|----------|
var A 1    | A:.ds 1 | определение переменной
r1 = r2   | MOV R1,R2   |            |
r = A     | LOAD R,A    | загрузка из ячейки памяти A |
r = M[B + D] | LOAD R,D(B) | загрузка из ячейки памяти по адресу B + D |
r = I     | MVI R,I     | загрузка значения I в регистр r |
r -> A     | STOR R,A    | запись в ячейку памяти A |
r -> M[B + D] | STOR R,D(B) | запись в ячейку памяти по адресу B + D |
push r    | PUSH R      | помещение значения регистра r на стек |
pop r     | POP R       | извлечение значения из стека в регистр r |
swap | XCHG        |  |
input a | IN N        | ввод в регистр А |
input b | IN N,xchg        | ввод в регистр Б |
input A | IN N,stor a,A       | ввод в абсолютную |
input M[B + D] | IN N,stor a,M[B + D]        | ввод в абсолютную |
input I | IN I        | ввод в определенный поток|
out {r,A,M[B+D],I} | ...      | те же правила, что и для input|
r1 += r2  | ADR R1,R2   | сложение регистров |
r += A    | ADM R,A     | сложение регистра и значения из ячейки памяти A |
r += M[B + D] | ADM R,D(B)  | сложение регистра и значения из ячейки памяти по адресу B + D |
r += I    | ADI R,I     | сложение регистра и значения I |
r1 -= r2  | SBR R1,R2   | вычитание регистров |
r -= A    | SBM R,A     | вычитание значения из ячейки памяти A из регистра |
r -= M[B + D] | SBM R,D(B)  | вычитание значения из ячейки памяти по адресу B + D из регистра |
r -= I    | SBI R,I     | вычитание значения I из регистра |
r1 *= r2  | MUR R1,R2   | умножение регистров |
r *= A    | MUM R,A     | умножение регистра и значения из ячейки памяти A |
r *= M[B + D] | MUM R,D(B)  | умножение регистра и значения из ячейки памяти по адресу B + D |
r *= I    | MUI R,I     | умножение регистра и значения I |
r /= A    | DVM R,A     | деление регистра на значение из ячейки памяти A |
r /= I    | DVI R,I     | деление регистра на значение I |
stop      | stop        | 
label:    | label:      |
Jxx label | Jxx label |       
call label | call label |  
--------------------------------------

### Условный оператор
Грамматика условного выражения:
```gram
if <cond> <any> label
```
- [if] - ключевое слово
- [cond] - условное выражение, но так как оно является разновидностью выражения в общем, то на месте cond может стоять и арифметическое выражение, но тогда в консоли вы увидите бред.
- [any] - это абсолютно любой непустой символ, будто ':', 'then', 'so', 'xd'
- [label] - метка, куда будет совершен прыжок, если [cond] выдаст true.

### Операторы сравнения
==, <, >, >=, <=
### Таблица трансляции
| Симкод   | Результат трансляции    
|----------|--------------------|
r1 == r2   | cmr r1,r2; jz label | 
r1 == I   | cmi r1,I; jz label | 
A == r2   | load r1,A; cmr r1,r2; jz label | 
A == I   | load r1,A; cmi r1,I; jz label | 
M[B+D] == I   | load r1,A; cmi r1,I; jz label | 
M[B+D] == r2   | load r1,A; cmi r1,I; jz label | 
O1 <=> O2   | дальше по аналогии | 

Стоит обратить внимание на две вещи:
1. Правым операндом не может быть абсолютная память. Этому есть объяснение.
Единственный выход трансляции выражения A1 <=> A2 это:
```asm
push a
push b
load a,A1
load b,A2
cmr a,b
jxx label
pop b
pop a
```
Вполне изящный вывод, но очень большой. Было принято решение избегать выходной трасляции, состоящей более чем из 3-х строк.
<br />2. Будьте аккуратны при использовании симкода. Значение регистров может быть испорчено, проверяйте результат трансляции!
## Использование
К сожалению, есть версия только для windows.
Пример использования:
```sh
$ apr.exe <file>
```
В консоли увидите результат трансляции.

### Зачем этот проект?
Возможно, этот проект кому-то будет полезен.

## Команда проекта
- eastpris [Самохвалов Д.А.]

## Источники
https://habr.com/ru/articles/840070/
